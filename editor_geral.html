<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Conte√∫do Geral</title>
    <style>
        /* (Estilos semelhantes ao editor.html e utilidades_arquivo.html) */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
        body { background: #0d0d0d; color: #fff; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
        h1 { font-size: 2rem; margin-bottom: 1.5rem; color: #007bff; }
        .container { background: #181818; padding: 2rem; border-radius: 1rem; width: 100%; max-width: 600px; box-shadow: 0 0 20px rgba(0,0,0,0.3); }
        label { font-size: 0.95rem; color: #ccc; display: block; margin-bottom: 0.3rem; margin-top: 1rem; }
        input, textarea { width: 100%; padding: 0.7rem; border-radius: 6px; border: 1px solid #333; background: #0f0f0f; color: #fff; font-size: 0.95rem; }
        button { background: linear-gradient(90deg, #007bff, #0056b3); color: #fff; border: none; padding: 0.7rem 1.2rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: all 0.3s ease; margin-top: 15px; }
        button:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); }
        .notificacao { position: fixed; bottom: 30px; right: 30px; background: #25D366; color: #000; padding: 1rem 1.5rem; border-radius: 10px; font-weight: 600; box-shadow: 0 0 20px rgba(37, 211, 102, 0.6); opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; z-index: 999; }
        .notificacao.mostrar { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <h1>Editor de Conte√∫do Geral üåê</h1>

    <div class="container">
        <button id="carregarIndexBtn">1. Selecionar/Carregar index.html</button>
        <p id="status" style="color: #f0c000; margin-top: 1rem;">Aguardando o carregamento do arquivo...</p>
        
        <form id="editorGeralForm" style="display:none;">
            <h2>Conte√∫do Principal (SEO e T√≠tulos)</h2>
            
            <label for="editTitle">T√≠tulo da P√°gina (&lt;title&gt;):</label>
            <input type="text" id="editTitle" required>

            <label for="editMetaDescription">Meta Descri√ß√£o (&lt;meta name="description"&gt;):</label>
            <textarea id="editMetaDescription" rows="3" required></textarea>
            
            <label for="editMainH1">T√≠tulo Principal (&lt;h1&gt; no &lt;body&gt; - Exemplo):</label>
            <input type="text" id="editMainH1" required>

            <button type="submit">2. Salvar Altera√ß√µes no index.html</button>
        </form>
    </div>

    <div id="notificacao" class="notificacao"></div>

    <script>
        let indexFileHandle = null;
        let originalContent = '';
        const statusEl = document.getElementById('status');
        const editorGeralForm = document.getElementById('editorGeralForm');

        function mostrarNotificacao(mensagem, sucesso = true) {
            const notificacao = document.getElementById('notificacao');
            notificacao.textContent = mensagem;
            notificacao.style.background = sucesso ? '#25D366' : '#dc3545';
            notificacao.classList.add('mostrar');
            setTimeout(() => notificacao.classList.remove('mostrar'), 3000);
        }

        function extractContent(html, tagName, attributeName = null) {
            let regex;
            if (attributeName === 'name') {
                regex = new RegExp(`(<meta\\s+name="${tagName}"\\s+content=")(.*?)(?="\\s*\/?>)`, 'is');
                const match = html.match(regex);
                return match ? match[2].trim() : '';
            } else {
                regex = new RegExp(`(<${tagName}.*?>)(.*?)(<\/${tagName}>)`, 'is');
                const match = html.match(regex);
                return match ? match[2].trim() : '';
            }
        }
        
        function replaceContent(html, tagName, newContent, attributeName = null) {
            if (attributeName === 'name') {
                // Para meta tags (ajusta apenas o atributo content)
                const regex = new RegExp(`(<meta\\s+name="${tagName}"\\s+content=")(.*?)(?="\\s*\/?>)`, 'is');
                return html.replace(regex, `$1${newContent}$3`);
            } else {
                // Para tags de bloco (ajusta o conte√∫do interno)
                const regex = new RegExp(`(<${tagName}.*?>)(.*?)(<\/${tagName}>)`, 'is');
                return html.replace(regex, `$1${newContent}$3`);
            }
        }

        async function carregarIndexHtml() {
            try {
                const [handle] = await window.showOpenFilePicker({ types: [{ description: "HTML Files (index.html)", accept: { "text/html": [".html"] } }] });
                indexFileHandle = handle;
                const file = await indexFileHandle.getFile();
                originalContent = await file.text();

                // Extrai e preenche os campos
                document.getElementById('editTitle').value = extractContent(originalContent, 'title');
                document.getElementById('editMetaDescription').value = extractContent(originalContent, 'description', 'name');
                document.getElementById('editMainH1').value = extractContent(originalContent, 'h1'); // Assumindo o primeiro H1 principal

                editorGeralForm.style.display = 'block';
                statusEl.textContent = "Arquivo carregado. Edite os campos abaixo.";
                mostrarNotificacao("‚úÖ index.html carregado!");
            } catch (err) {
                console.error("Erro ao carregar:", err);
                statusEl.textContent = "Aguardando o carregamento do arquivo...";
                mostrarNotificacao("‚ö†Ô∏è A√ß√£o cancelada ou erro ao carregar o arquivo.", false);
            }
        }

        async function salvarAlteracoes(e) {
            e.preventDefault();
            if (!indexFileHandle) {
                mostrarNotificacao("‚ùå Nenhum arquivo carregado.", false);
                return;
            }

            let novoConteudo = originalContent;

            // 1. Atualiza T√≠tulo
            const newTitle = document.getElementById('editTitle').value.trim();
            novoConteudo = replaceContent(novoConteudo, 'title', newTitle);

            // 2. Atualiza Meta Description
            const newMetaDescription = document.getElementById('editMetaDescription').value.trim();
            novoConteudo = replaceContent(novoConteudo, 'description', newMetaDescription, 'name');
            
            // 3. Atualiza H1 principal
            const newMainH1 = document.getElementById('editMainH1').value.trim();
            novoConteudo = replaceContent(novoConteudo, 'h1', newMainH1); // Nota: Isso substitui o primeiro H1 que encontrar.

            try {
                const writable = await indexFileHandle.createWritable();
                await writable.write(novoConteudo);
                await writable.close();
                originalContent = novoConteudo; // Atualiza o cache interno
                mostrarNotificacao("üíæ Altera√ß√µes salvas com sucesso no index.html!");

            } catch (err) {
                console.error("Erro ao salvar:", err);
                mostrarNotificacao("‚ùå Erro ao salvar o index.html. Verifique permiss√µes.", false);
            }
        }

        document.getElementById('carregarIndexBtn').addEventListener('click', carregarIndexHtml);
        editorGeralForm.addEventListener('submit', salvarAlteracoes);
    </script>
</body>
</html>
