<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Canecas</title>
  <style>
    /* Estilos (Mantidos) */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: #0d0d0d;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #25D366;
    }

    form {
      background: #181818;
      padding: 1.5rem;
      border-radius: 1rem;
      width: 100%;
      max-width: 550px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    label { font-size: 0.95rem; color: #ccc; display: block; margin-bottom: 0.3rem; }
    input, textarea, select {
      width: 100%;
      padding: 0.7rem;
      border-radius: 6px;
      border: 1px solid #333;
      background: #0f0f0f;
      color: #fff;
      font-size: 0.95rem;
    }

    textarea { resize: vertical; }

    .cores-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .cores-container label {
      background: #0f0f0f;
      padding: 6px 10px;
      border: 1px solid #333;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .cores-container input { display: none; }

    .cores-container input:checked + span {
      background: #25D366;
      color: #fff;
      border-color: #25D366;
      box-shadow: 0 0 10px rgba(37,211,102,0.5);
      border-radius: 6px;
      padding: 5px 10px;
    }

    button {
      background: linear-gradient(90deg, #25D366, #1ebe5f);
      color: #fff;
      border: none;
      padding: 0.8rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: all 0.3s ease;
      margin-top: 0.5rem;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(37,211,102,0.6);
    }

    .output {
      margin-top: 2rem;
      width: 100%;
      max-width: 600px;
      background: #111;
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      color: #0f0;
      white-space: pre-wrap;
      overflow-x: auto;
      border: 1px solid #333;
    }

    .copy-btn {
      margin-top: 0.5rem;
      background: #007bff;
      color: #fff;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .copy-btn:hover { background: #0056b3; }

    /* Pr√©-visualiza√ß√£o */
    .preview {
      margin-top: 2rem;
      width: 100%;
      max-width: 300px;
      background: #181818;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }
    .preview img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 0.8rem;
      object-fit: contain;
    }
    .preview h2 {
      font-size: 1.2rem;
      color: #25D366;
    }
    .preview p {
      font-size: 0.9rem;
      color: #ccc;
      margin-top: 0.2rem;
    }
    .preview button {
      margin-top: 0.8rem;
      background: linear-gradient(90deg, #25D366, #1ebe5f);
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
      border-radius: 20px;
      border: none;
      cursor: pointer;
    }
    /* Estilo para inputs de imagem dos modelos */
    .imagem-modelo-input {
        margin-top: 1rem;
        padding-top: 0.8rem;
        border-top: 1px solid #333;
    }
  </style>
</head>
<body>

  <h1>Gerador de Canecas üñãÔ∏è</h1>

  <form id="geradorForm">
    <div>
      <label>ID do Produto:</label>
      <input type="text" id="idProduto" placeholder="Ex: CN001" required>
    </div>

    <div>
      <label>Nome da Caneca:</label>
      <input type="text" id="nome" placeholder="Ex: Caneca Cora√ß√£o" required>
    </div>

    <div>
      <label>Descri√ß√£o:</label>
      <textarea id="descricao" placeholder="Ex: Material: Cer√¢mica; Capacidade: 325ml; Estampa: Cora√ß√£o" required></textarea>
    </div>
    
    <div>
      <label>Categoria:</label>
      <select id="categoria" required>
        <option value="">Selecione</option>
        <option value="geek">Geek</option>
        <option value="floral">Floral</option>
        <option value="minimalista">Minimalista</option>
        <option value="personalizada">Com Nome</option>
      </select>
    </div>

    <div>
      <label>Modelos/Cores dispon√≠veis:</label>
      <div class="cores-container" id="coresContainer">
        <label><input type="checkbox" value="Branca"><span>Branca</span></label>
        <label><input type="checkbox" value="Preta"><span>Preta</span></label>
        <label><input type="checkbox" value="Vermelha"><span>Vermelha</span></label>
        <label><input type="checkbox" value="Laranja"><span>Laranja</span></label>
        <label><input type="checkbox" value="Rosa"><span>Rosa</span></label>
        <label><input type="checkbox" value="Verde Escuro"><span>Verde Escuro</span></label>
        <label><input type="checkbox" value="Verde Claro"><span>Verde Claro</span></label>
        <label><input type="checkbox" value="Azul Claro"><span>Azul Claro</span></label>
        <label><input type="checkbox" value="Azul"><span>Azul</span></label>
        <label><input type="checkbox" value="Azul Escuro"><span>Azul Escuro</span></label>
      </div>
    </div>
    
    <div id="imagemModelosContainer"></div>

    <button type="submit">Gerar C√≥digo</button>
  </form>

  <div id="preview" class="preview" style="display:none;">
    <img id="previewImage" src="" alt="Pr√©via">
    <h2 id="previewNome"></h2>
    <p id="previewId"></p>
    <p id="previewPreco"></p>
    <button>Ver Detalhes</button>
  </div>

  <div id="resultado" class="output" style="display:none;"></div>
  <button id="copiar" class="copy-btn" style="display:none;">Copiar C√≥digo</button>

  <script>
    const form = document.getElementById('geradorForm');
    const resultado = document.getElementById('resultado');
    const copiarBtn = document.getElementById('copiar');
    const preview = document.getElementById('preview');
    const coresContainer = document.getElementById('coresContainer');
    const imagemModelosContainer = document.getElementById('imagemModelosContainer');
    
    // Elementos da pr√©-visualiza√ß√£o
    const previewNome = document.getElementById('previewNome');
    const previewId = document.getElementById('previewId');
    const previewPreco = document.getElementById('previewPreco');
    const previewImage = document.getElementById('previewImage');

    function atualizarCamposDeImagem() {
        const coresSelecionadas = Array.from(coresContainer.querySelectorAll('input:checked')).map(i => i.value);
        imagemModelosContainer.innerHTML = "";
        
        // Se houver pelo menos um modelo selecionado, mostra os campos individuais
        if (coresSelecionadas.length > 0) {
            coresSelecionadas.forEach(cor => {
                const safeCor = cor.replace(/\s/g, '_');
                
                const div = document.createElement('div');
                div.className = 'imagem-modelo-input';
                
                const labelModelo = document.createElement('label');
                labelModelo.innerHTML = `Op√ß√µes para o Modelo "<strong>${cor}</strong>":`;
                div.appendChild(labelModelo);

                // 1. Input para Pre√ßo
                const divPreco = document.createElement('div');
                divPreco.style.marginBottom = '10px';
                const labelPreco = document.createElement('label');
                labelPreco.textContent = `Pre√ßo (R$):`;
                const inputPreco = document.createElement('input');
                inputPreco.type = 'number';
                inputPreco.step = '0.01';
                inputPreco.name = `precoModelo_${safeCor}`;
                inputPreco.placeholder = `Pre√ßo da caneca ${cor}...`;
                inputPreco.required = true;
                
                divPreco.appendChild(labelPreco);
                divPreco.appendChild(inputPreco);
                div.appendChild(divPreco);


                // 2. Input para Link da Imagem
                const divImagem = document.createElement('div');
                const labelImagem = document.createElement('label');
                labelImagem.textContent = `Link da Imagem:`;
                const inputImagem = document.createElement('input');
                inputImagem.type = 'url';
                inputImagem.name = `imagemModelo_${safeCor}`;
                inputImagem.placeholder = `URL da imagem para a caneca ${cor}...`;
                inputImagem.required = true;
                divImagem.appendChild(labelImagem);
                divImagem.appendChild(inputImagem);
                div.appendChild(divImagem);

                imagemModelosContainer.appendChild(div);
            });
        }
    }

    // Atualiza a pr√©via baseada no primeiro modelo selecionado
    form.addEventListener('input', () => {
      const nome = document.getElementById('nome').value.trim();
      const id = document.getElementById('idProduto').value.trim();
      
      const coresSelecionadas = Array.from(coresContainer.querySelectorAll('input:checked')).map(i => i.value);
      
      let precoModelo = "";
      let imagemModelo = "";

      if (coresSelecionadas.length > 0) {
          const safeCor = coresSelecionadas[0].replace(/\s/g, '_');
          const inputPreco = document.querySelector(`input[name="precoModelo_${safeCor}"]`);
          const inputImagem = document.querySelector(`input[name="imagemModelo_${safeCor}"]`);
          
          if (inputPreco && inputPreco.value) precoModelo = parseFloat(inputPreco.value).toFixed(2);
          if (inputImagem) imagemModelo = inputImagem.value.trim();
      }

      // Atualiza a pr√©via
      if (imagemModelo) {
        previewImage.src = imagemModelo;
        previewImage.style.display = "block";
      } else {
        previewImage.src = "";
        previewImage.style.display = "none";
      }

      previewNome.textContent = nome || "Nome da Caneca";
      previewId.textContent = id ? `ID: ${id}` : "";
      previewPreco.textContent = precoModelo ? `R$ ${precoModelo.replace('.', ',')}` : "";

      preview.style.display = nome || precoModelo || imagemModelo ? "block" : "none";
    });

    coresContainer.addEventListener('change', atualizarCamposDeImagem);

    form.addEventListener('submit', e => {
      e.preventDefault();

      const id = document.getElementById('idProduto').value.trim();
      const nome = document.getElementById('nome').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const categoria = document.getElementById('categoria').value;
      const coresSelecionadas = Array.from(document.querySelectorAll('.cores-container input:checked')).map(i => i.value);

      // NOVO: Valida√ß√£o para garantir que pelo menos um modelo foi selecionado
      if (coresSelecionadas.length === 0) {
          return alert('Selecione pelo menos um Modelo/Cor dispon√≠vel para gerar o c√≥digo.');
      }
      if (!nome || !descricao || !categoria) return alert('Por favor, preencha todos os campos obrigat√≥rios.');

      let optionsArray = []; 
      let allValid = true;

      // 1. Gera√ß√£o e Valida√ß√£o de TODAS as Op√ß√µes
      coresSelecionadas.forEach(cor => {
          const safeCor = cor.replace(/\s/g, '_');
          const inputImagemModelo = document.querySelector(`input[name="imagemModelo_${safeCor}"]`);
          const inputPrecoModelo = document.querySelector(`input[name="precoModelo_${safeCor}"]`);
          
          const imagemModelo = inputImagemModelo ? inputImagemModelo.value.trim() : null;
          const precoModeloValue = inputPrecoModelo ? parseFloat(inputPrecoModelo.value) : null;
          const precoModelo = precoModeloValue !== null && !isNaN(precoModeloValue) ? precoModeloValue.toFixed(2) : null;
          
          // Valida√ß√£o de campos din√¢micos (todos os selecionados devem ter pre√ßo e imagem)
          if (!imagemModelo || !precoModelo) {
              alert(`Preencha o link de imagem e o pre√ßo v√°lidos para o modelo "${cor}".`);
              allValid = false;
              return;
          }

          optionsArray.push({
              model: cor,
              price: precoModelo,
              image: imagemModelo
          });
      });

      if (!allValid) return; // Se a valida√ß√£o falhar, para a fun√ß√£o.

      // 2. Definir Pre√ßo/Imagem para a Galeria (SEMPRE √© o primeiro item do optionsArray)
      const primeiroModelo = optionsArray[0];
      
      const imagemParaGaleria = primeiroModelo.image;
      const precoExibidoNaGaleria = primeiroModelo.price.replace('.', ',');

      // 3. Gerar string options para data-options
      const optionsString = optionsArray.map(opt => 
          `{"model":"${opt.model}","price":${opt.price},"image":"${opt.image}"}`
      ).join(',\n        ');

      // 4. Gerar o C√≥digo Final
      const codigo = `
<div class="item" data-categoria="${categoria}">
  <img src="${imagemParaGaleria}" alt="${nome}">
  <div class="info">
    <h2>${nome}</h2>
    <p>ID: ${id}</p>
    <p>R$ ${precoExibidoNaGaleria}</p>
    <button class="open-modal-btn"
      data-name="${nome}"
      data-id="${id}"
      data-image="${imagemParaGaleria}"
      data-specs="${descricao}"
      data-options='[
        ${optionsString}
      ]'>Ver Detalhes</button>
  </div>
</div>`.trim();

      resultado.style.display = 'block';
      copiarBtn.style.display = 'inline-block';
      resultado.textContent = codigo;
    });

    copiarBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(resultado.textContent);
      copiarBtn.textContent = 'Copiado ‚úÖ';
      setTimeout(() => copiarBtn.textContent = 'Copiar C√≥digo', 2000);
    });

    // Chama a fun√ß√£o ao carregar para garantir a l√≥gica inicial
    atualizarCamposDeImagem(); 
  </script>
</body>
</html>
