<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Cards</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: #0d0d0d; color: #fff; min-height: 100vh;
      display: flex; flex-direction: column; align-items: center; padding: 2rem;
    }
    h1 { font-size: 2rem; margin-bottom: 1.5rem; color: #25D366; }
    form {
      background: #181818; padding: 1.5rem; border-radius: 1rem;
      width: 100%; max-width: 550px; display: flex; flex-direction: column;
      gap: 1rem; box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    label { font-size: 0.95rem; color: #ccc; display: block; margin-bottom: 0.3rem; }
    input, textarea, select {
      width: 100%; padding: 0.7rem; border-radius: 6px; border: 1px solid #333;
      background: #0f0f0f; color: #fff; font-size: 0.95rem;
    }
    textarea { resize: vertical; }
    .cores-container {
      display: flex; flex-wrap: wrap; gap: 10px;
    }
    .cores-container label {
      background: #0f0f0f; padding: 6px 10px; border: 1px solid #333;
      border-radius: 6px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;
    }
    .cores-container input { display: none; }
    .cores-container input:checked + span {
      background: #25D366; color: #fff; border-color: #25D366;
      box-shadow: 0 0 10px rgba(37,211,102,0.5);
      border-radius: 6px; padding: 5px 10px;
    }
    .button-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    button {
      background: linear-gradient(90deg, #25D366, #1ebe5f);
      color: #fff; border: none; padding: 0.8rem;
      border-radius: 8px; cursor: pointer; font-size: 1rem;
      font-weight: bold; transition: all 0.3s ease; 
    }
    button:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(37,211,102,0.6); }
    
    /* Estilo para o bot√£o de pr√©via */
    #visualizarPreview {
        background: linear-gradient(90deg, #007bff, #0056b3);
    }
    #visualizarPreview:hover {
        box-shadow: 0 0 20px rgba(0,123,255,0.6);
    }

    .output {
      margin-top: 2rem; width: 100%; max-width: 600px;
      background: #111; padding: 1rem; border-radius: 8px;
      font-family: monospace; color: #0f0; white-space: pre-wrap;
      overflow-x: auto; border: 1px solid #333;
    }
    .copy-btn {
      margin-top: 0.5rem; background: #007bff; color: #fff;
      border: none; padding: 0.6rem 1rem; border-radius: 6px;
      cursor: pointer; transition: background 0.3s ease;
    }
    .copy-btn:hover { background: #0056b3; }
    .imagem-modelo-input { margin-top: 1rem; padding-top: 0.8rem; border-top: 1px solid #333; }

    /* üîî Notifica√ß√£o visual */
    .notificacao {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #25D366;
      color: #000;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(37, 211, 102, 0.6);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 999;
    }
    .notificacao.mostrar {
      opacity: 1;
      transform: translateY(0);
    }

    /* üñºÔ∏è Estilos do MODAL DE PREVIEW */
    .modal {
        display: none; /* Escondido por padr√£o */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.8); 
        padding-top: 60px;
    }

    .modal-content {
        background-color: #181818;
        margin: 5% auto; /* 5% do topo e centralizado */
        padding: 20px;
        border: 1px solid #444;
        width: 80%;
        max-width: 500px;
        border-radius: 10px;
        position: relative;
    }

    .modal-content h3 {
        color: #25D366;
        margin-bottom: 1rem;
        text-align: center;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 20px;
        cursor: pointer;
    }

    .close:hover,
    .close:focus {
        color: #fff;
        text-decoration: none;
        cursor: pointer;
    }
    
    /* üé® Estilos para simular o Card dentro do Modal (Mantenha se quiser) */
    #previewContent .item {
      background: #0d0d0d; 
      padding: 1rem; 
      border-radius: 8px; 
      display: flex; 
      flex-direction: column;
      align-items: center; 
      gap: 1rem; 
      margin-bottom: 1rem;
      border: 1px solid #444;
      text-align: center;
    }
    #previewContent .item img {
      width: 100px; 
      height: 100px; 
      object-fit: cover; 
      border-radius: 4px;
    }
    #previewContent .item .info h2 {
      font-size: 1.2rem; 
      color: #25D366; 
      margin-bottom: 0.3rem;
    }
    #previewContent .item .info p {
      font-size: 0.9rem; 
      color: #ccc; 
      line-height: 1.4;
    }
    #previewContent .open-modal-btn {
      /* Estilo de um bot√£o dentro do card */
      background: #007bff;
      padding: 0.5rem 1rem; 
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

  </style>
</head>
<body>
  <h1>Gerador de Cards</h1>

  <form id="geradorForm">
    <div>
      <label>ID do Produto:</label>
      <input type="text" id="idProduto" placeholder="Ex: CN001" required>
    </div>
    <div>
      <label>Nome do Produto:</label>
      <input type="text" id="nome" placeholder="Ex: Caneca Cora√ß√£o" required>
    </div>
    <div>
      <label>Descri√ß√£o:</label>
      <textarea id="descricao" placeholder="Ex: Material: Cer√¢mica; Capacidade: 325ml; Estampa: Cora√ß√£o" required></textarea>
    </div>
    <div>
      <label>Categoria:</label>
      <select id="categoria" required>
        <option value="">Selecione</option>
        <option value="Brancas">Brancas</option>
        <option value="Coloridas">Coloridas</option>
        <option value="dia das maes">Dia das m√£es</option>
        <option value="dia dos pais">Dia dos Pais</option>
        <option value="dia dos professores">Dia dos professores</option>
        <option value="Pets">Pets</option>
        <option value="herois">Herois</option>
        <option value="animes">Animes</option>
        <option value="foto">Com Foto</option>
        <option value="futebol">Futebol</option>
      </select>
    </div>
    <div>
      <label>Modelos/Cores dispon√≠veis:</label>
      <div class="cores-container" id="coresContainer">
        <label><input type="checkbox" value="Branca"><span>Branca</span></label>
        <label><input type="checkbox" value="Preta"><span>Preta</span></label>
        <label><input type="checkbox" value="Vermelha"><span>Vermelha</span></label>
        <label><input type="checkbox" value="Laranja"><span>Laranja</span></label>
        <label><input type="checkbox" value="Rosa"><span>Rosa</span></label>
        <label><input type="checkbox" value="Verde Escuro"><span>Verde Escuro</span></label>
        <label><input type="checkbox" value="Verde Claro"><span>Verde Claro</span></label>
        <label><input type="checkbox" value="Azul Claro"><span>Azul Claro</span></label>
        <label><input type="checkbox" value="Azul"><span>Azul</span></label>
        <label><input type="checkbox" value="Azul Escuro"><span>Azul Escuro</span></label>
      </div>
    </div>

    <div id="imagemModelosContainer"></div>
    
    <div class="button-group">
        <button type="submit">Gerar C√≥digo</button>
        <button type="button" id="inserirIndex">Inserir no index.html</button>
        <button type="button" id="visualizarPreview">Pr√©via do Card (Modal)</button> </div>
  </form>

  <div id="resultado" class="output" style="display:none;"></div>
  <button id="copiar" class="copy-btn" style="display:none;">Copiar C√≥digo</button>

  <div id="notificacao" class="notificacao">‚úÖ Produto adicionado com sucesso!</div>
  
  <div id="previewModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Pr√©via do Card do Produto</h3>
      <div id="previewContent">
        </div>
    </div>
  </div>
  <script>
    const form = document.getElementById('geradorForm');
    const coresContainer = document.getElementById('coresContainer');
    const imagemModelosContainer = document.getElementById('imagemModelosContainer');
    const resultado = document.getElementById('resultado');
    const copiarBtn = document.getElementById('copiar');
    const inserirIndexBtn = document.getElementById('inserirIndex');
    const visualizarPreviewBtn = document.getElementById('visualizarPreview'); // NOVO
    const notificacao = document.getElementById('notificacao');
    
    // Elementos do Modal
    const previewModal = document.getElementById('previewModal'); // NOVO
    const previewContent = document.getElementById('previewContent'); // NOVO
    const closeModalBtn = document.getElementsByClassName('close')[0]; // NOVO

    function atualizarCamposDeImagem() {
      const coresSelecionadas = Array.from(coresContainer.querySelectorAll('input:checked')).map(i => i.value);
      imagemModelosContainer.innerHTML = "";
      coresSelecionadas.forEach(cor => {
        const safeCor = cor.replace(/\s/g, '_');
        const div = document.createElement('div');
        div.className = 'imagem-modelo-input';
        div.innerHTML = `
          <label>Modelo "${cor}"</label>
          <label>Pre√ßo (R$):</label>
          <input type="number" step="0.01" name="precoModelo_${safeCor}" required>
          <label>Link da Imagem:</label>
          <input type="url" name="imagemModelo_${safeCor}" placeholder="URL da imagem..." required>
        `;
        imagemModelosContainer.appendChild(div);
      });
    }

    coresContainer.addEventListener('change', atualizarCamposDeImagem);

    function gerarCodigo() {
      const id = document.getElementById('idProduto').value.trim();
      const nome = document.getElementById('nome').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const categoria = document.getElementById('categoria').value;
      const coresSelecionadas = Array.from(document.querySelectorAll('.cores-container input:checked')).map(i => i.value);

      if (!id || !nome || !descricao || !categoria || coresSelecionadas.length === 0) {
        alert('Preencha todos os campos e selecione pelo menos uma cor.');
        return null;
      }

      const optionsArray = coresSelecionadas.map(cor => {
        const safeCor = cor.replace(/\s/g, '_');
        const preco = document.querySelector(`input[name="precoModelo_${safeCor}"]`).value || 0;
        const imagem = document.querySelector(`input[name="imagemModelo_${safeCor}"]`).value.trim();
        return { model: cor, price: parseFloat(preco), image: imagem };
      });

      const primeiraImagem = optionsArray[0].image;
      const precoExibido = optionsArray[0].price.toFixed(2).replace('.', ',');

      const codigo = `
<div class="item" data-categoria="${categoria}">
  <img src="${primeiraImagem}" alt="${nome}">
  <div class="info">
    <h2>${nome}</h2>
    <p>ID: ${id}</p>
    <p>R$ ${precoExibido}</p>
    <button class="open-modal-btn"
      data-name="${nome}"
      data-id="${id}"
      data-image="${primeiraImagem}"
      data-specs="${descricao}"
      data-options='${JSON.stringify(optionsArray)}'>
      Ver Detalhes
    </button>
  </div>
</div>`.trim();

      // EXIBE O C√ìDIGO FONTE na √°rea de output
      resultado.style.display = 'block';
      copiarBtn.style.display = 'inline-block';
      resultado.textContent = codigo; // Mantido como textContent para exibir o c√≥digo fonte
      resultado.setAttribute('data-copy-content', codigo); 
      
      return codigo;
    }

    // Fun√ß√£o para abrir o modal de pr√©via
    function abrirPreviewModal() {
        const card = gerarCodigo();
        if (!card) return;

        // Injeta o c√≥digo HTML do card no conte√∫do do modal
        previewContent.innerHTML = card; 
        previewModal.style.display = "block";
    }

    // Fun√ß√£o para fechar o modal
    function fecharPreviewModal() {
        previewModal.style.display = "none";
    }

    // Event Listeners
    form.addEventListener('submit', e => {
      e.preventDefault();
      // Ao submeter, apenas gera e exibe o c√≥digo fonte na √°rea de output
      gerarCodigo(); 
    });

    copiarBtn.addEventListener('click', () => {
      const codigoFonte = resultado.getAttribute('data-copy-content') || resultado.textContent;
      navigator.clipboard.writeText(codigoFonte);
      copiarBtn.textContent = 'Copiado ‚úÖ';
      setTimeout(() => copiarBtn.textContent = 'Copiar C√≥digo', 2000);
    });

    visualizarPreviewBtn.addEventListener('click', abrirPreviewModal); // NOVO EVENTO

    closeModalBtn.addEventListener('click', fecharPreviewModal); // FECHAR AO CLICAR NO 'x'
    
    // Fechar o modal clicando fora dele
    window.addEventListener('click', (event) => {
        if (event.target == previewModal) {
            fecharPreviewModal();
        }
    });

    function mostrarNotificacao(mensagem) {
      notificacao.textContent = mensagem;
      notificacao.classList.add('mostrar');
      setTimeout(() => notificacao.classList.remove('mostrar'), 3000);
    }

    inserirIndexBtn.addEventListener('click', async () => {
      const card = gerarCodigo();
      if (!card) return;
      try {
        const [fileHandle] = await window.showOpenFilePicker({
          types: [{ description: "HTML Files", accept: { "text/html": [".html"] } }],
          multiple: false
        });
        const file = await fileHandle.getFile();
        let content = await file.text();

        const inicioSection = content.indexOf('<section class="galeria">');
        if (inicioSection !== -1) {
          const posicaoInsercao = content.indexOf('>', inicioSection) + 1;
          const novoConteudo = content.slice(0, posicaoInsercao) + "\n" + card + "\n" + content.slice(posicaoInsercao);
          const writable = await fileHandle.createWritable();
          await writable.write(novoConteudo);
          await writable.close();
          mostrarNotificacao("‚úÖ Produto adicionado no topo da galeria!");
        } else {
          mostrarNotificacao("‚ùå N√£o foi poss√≠vel encontrar a <section class='galeria'> no arquivo index.html");
        }
      } catch (err) {
        console.error(err);
        mostrarNotificacao("‚ö†Ô∏è A√ß√£o cancelada ou n√£o suportada pelo navegador.");
      }
    });
  </script>
</body>
</html>
